import numpy as np
import glob
import lepm.stringformat as sf
from scipy import interpolate

"""Provide information of band gaps for using in bott or chern measurements"""


def gapfreq_magnetic_glat(mglat, eps=1e-5, interpolate=False):
    """

    Parameters
    ----------
    mglat : MagneticGyroLattice instance
    eps : float
        Absolute difference below which we consider the lookup value of aoverl and/or ABDelta to match exactly

    Returns
    -------

    """
    print 'mglat.lp = ', mglat.lp
    if mglat.lp['LatticeTop'] == 'hexagonal' and not interpolate:
        eigval = mglat.get_eigval()
        top = int(len(eigval) * 0.75)
        midfreq = [np.mean([np.imag(eigval[top - 1]), np.imag(eigval[top])])]
        # sys.exit()
    elif mglat.lp['LatticeTop'] == 'hexagonal' and interpolate:
        # aoverl, Delta_AB, gapmin frequency, gapmax frequency
        data = np.array([[2.500000000000000000e-01, 0.000000000000000000e+00,  2.109374999999998224e+00,  1.182042122159371322e+00],
                         [2.500000000000000000e-01, 1.000000000000000056e-01,  2.009374999999999911e+00,  1.184621199301782113e+00],
                         [2.500000000000000000e-01, 2.000000000000000111e-01,  1.909375000000000711e+00,  1.195554102483192827e+00],
                         [2.500000000000000000e-01, 3.000000000000000444e-01,  1.809374999999999956e+00,  1.225866640194950952e+00],
                         [2.500000000000000000e-01, 4.000000000000000222e-01,  1.709375000000000311e+00,  1.319455245903109253e+00],
                         [2.500000000000000000e-01, 5.000000000000000000e-01,  1.609374999999999778e+00,  1.419455245903109564e+00],
                         [2.500000000000000000e-01, 6.000000000000000888e-01,  1.519455245903108986e+00,  1.509375000000001021e+00],
                         [2.500000000000000000e-01, 7.000000000000000666e-01,  1.619455245903109075e+00,  1.409375000000001377e+00],
                         [2.500000000000000000e-01, 8.000000000000000444e-01,  1.719455245903108942e+00,  1.309375000000001066e+00],
                         [2.500000000000000000e-01, 9.000000000000000222e-01,  1.819455245903108143e+00,  1.209375000000001421e+00],
                         [2.500000000000000000e-01, 1.000000000000000000e+00,  1.919455245903108676e+00,  1.109375000000000888e+00],
                         [2.500000000000000000e-01, 1.100000000000000089e+00,  2.019455245903109208e+00,  1.009375000000001021e+00],
                         [2.500000000000000000e-01, 1.200000000000000178e+00,  2.119455245903109297e+00,  9.093750000000009326e-01],
                         [2.500000000000000000e-01, 1.300000000000000044e+00,  2.219455245903108054e+00,  8.093750000000003997e-01],
                         [2.500000000000000000e-01, 1.400000000000000133e+00,  2.319455245903109475e+00,  7.093750000000003109e-01],
                         [2.500000000000000000e-01, 1.500000000000000000e+00,  2.419455245903108676e+00,  6.093750000000006661e-01],
                         [2.500000000000000000e-01, 1.600000000000000089e+00,  2.519455245903108764e+00,  6.805447540968901921e-01],
                         [2.500000000000000000e-01, 1.700000000000000178e+00,  2.619455245903108853e+00,  7.805447540968902809e-01],
                         [2.500000000000000000e-01, 1.800000000000000044e+00,  2.719455245903108054e+00,  8.805447540968907028e-01],
                         [2.500000000000000000e-01, 1.900000000000000133e+00,  2.819455245903106366e+00,  9.805447540968921238e-01],
                         [2.500000000000000000e-01, 2.000000000000000000e+00,  2.919455245903106455e+00,  1.080544754096891547e+00],
                         [2.500000000000000000e-01, 2.100000000000000089e+00,  3.019455245903107432e+00,  1.180544754096891413e+00],
                         [2.500000000000000000e-01, 2.200000000000000178e+00,  3.119455245903106633e+00,  1.280544754096891724e+00],
                         [2.500000000000000000e-01, 2.300000000000000266e+00,  3.219455245903107610e+00,  1.380544754096891591e+00],
                         [2.999999999999999889e-01, 0.000000000000000000e+00,  2.102499999999997371e+00,  1.162780208164898355e+00],
                         [2.999999999999999889e-01, 1.000000000000000056e-01,  2.002499999999999947e+00,  1.165111930343678104e+00],
                         [2.999999999999999889e-01, 2.000000000000000111e-01,  1.902499999999999636e+00,  1.174338289261418256e+00],
                         [2.999999999999999889e-01, 3.000000000000000444e-01,  1.802499999999998437e+00,  1.198156188365079311e+00],
                         [2.999999999999999889e-01, 4.000000000000000222e-01,  1.702500000000000124e+00,  1.281577953161260996e+00],
                         [2.999999999999999889e-01, 5.000000000000000000e-01,  1.602500000000000036e+00,  1.381577953161261529e+00],
                         [2.999999999999999889e-01, 6.000000000000000888e-01,  1.502500000000000835e+00,  1.481577953161261618e+00],
                         [2.999999999999999889e-01, 7.000000000000000666e-01,  1.581577953161260819e+00,  1.402500000000001412e+00],
                         [2.999999999999999889e-01, 8.000000000000000444e-01,  1.681577953161260464e+00,  1.302500000000000879e+00],
                         [2.999999999999999889e-01, 9.000000000000000222e-01,  1.781577953161261219e+00,  1.202500000000001013e+00],
                         [2.999999999999999889e-01, 1.000000000000000000e+00,  1.881577953161261529e+00,  1.102500000000001146e+00],
                         [2.999999999999999889e-01, 1.100000000000000089e+00,  1.981577953161261396e+00,  1.002500000000000613e+00],
                         [2.999999999999999889e-01, 1.200000000000000178e+00,  2.081577953161261707e+00,  9.025000000000008571e-01],
                         [2.999999999999999889e-01, 1.300000000000000044e+00,  2.181577953161260908e+00,  8.025000000000006573e-01],
                         [2.999999999999999889e-01, 1.400000000000000133e+00,  2.281577953161261885e+00,  7.024999999999999023e-01],
                         [2.999999999999999889e-01, 1.500000000000000000e+00,  2.381577953161261529e+00,  6.184220468387385816e-01],
                         [2.999999999999999889e-01, 1.600000000000000089e+00,  2.481577953161261618e+00,  7.184220468387388925e-01],
                         [2.999999999999999889e-01, 1.700000000000000178e+00,  2.581577953161261263e+00,  8.184220468387389813e-01],
                         [2.999999999999999889e-01, 1.800000000000000044e+00,  2.681577953161260908e+00,  9.184220468387387371e-01],
                         [2.999999999999999889e-01, 1.900000000000000133e+00,  2.781577953161262773e+00,  1.018422046838738160e+00],
                         [2.999999999999999889e-01, 2.000000000000000000e+00,  2.881577953161261529e+00,  1.118422046838738915e+00],
                         [2.999999999999999889e-01, 2.100000000000000089e+00,  2.981577953161260730e+00,  1.218422046838739226e+00],
                         [2.999999999999999889e-01, 2.200000000000000178e+00,  3.081577953161261707e+00,  1.318422046838739092e+00],
                         [2.999999999999999889e-01, 2.300000000000000266e+00,  3.181577953161262684e+00,  1.418422046838738959e+00],
                         [3.499999999999999778e-01, 0.000000000000000000e+00,  2.094374999999998543e+00,  1.139615768315077160e+00],
                         [3.499999999999999778e-01, 1.000000000000000056e-01,  1.994375000000000897e+00,  1.141618235143653237e+00],
                         [3.499999999999999778e-01, 2.000000000000000111e-01,  1.894374999999999698e+00,  1.148620159712482769e+00],
                         [3.499999999999999778e-01, 3.000000000000000444e-01,  1.794374999999999609e+00,  1.167823811262876044e+00],
                         [3.499999999999999778e-01, 4.000000000000000222e-01,  1.694374999999999520e+00,  1.234509293967867238e+00],
                         [3.499999999999999778e-01, 5.000000000000000000e-01,  1.594374999999998987e+00,  1.334509293967866883e+00],
                         [3.499999999999999778e-01, 6.000000000000000888e-01,  1.494375000000000453e+00,  1.434509293967867416e+00],
                         [3.499999999999999778e-01, 7.000000000000000666e-01,  1.534509293967866839e+00,  1.394375000000000586e+00],
                         [3.499999999999999778e-01, 8.000000000000000444e-01,  1.634509293967867816e+00,  1.294375000000001386e+00],
                         [3.499999999999999778e-01, 9.000000000000000222e-01,  1.734509293967866794e+00,  1.194375000000000853e+00],
                         [3.499999999999999778e-01, 1.000000000000000000e+00,  1.834509293967866661e+00,  1.094375000000000764e+00],
                         [3.499999999999999778e-01, 1.100000000000000089e+00,  1.934509293967866972e+00,  9.943750000000006750e-01],
                         [3.499999999999999778e-01, 1.200000000000000178e+00,  2.034509293967867283e+00,  8.943750000000005862e-01],
                         [3.499999999999999778e-01, 1.300000000000000044e+00,  2.134509293967866483e+00,  7.943750000000007194e-01],
                         [3.499999999999999778e-01, 1.400000000000000133e+00,  2.234509293967867016e+00,  6.943750000000004086e-01],
                         [3.499999999999999778e-01, 1.500000000000000000e+00,  2.334509293967866661e+00,  6.654907060321334500e-01],
                         [3.499999999999999778e-01, 1.600000000000000089e+00,  2.434509293967867194e+00,  7.654907060321333168e-01],
                         [3.499999999999999778e-01, 1.700000000000000178e+00,  2.534509293967866839e+00,  8.654907060321334056e-01],
                         [3.499999999999999778e-01, 1.800000000000000044e+00,  2.634509293967866483e+00,  9.654907060321336054e-01],
                         [3.499999999999999778e-01, 1.900000000000000133e+00,  2.734509293967867016e+00,  1.065490706032133472e+00],
                         [3.499999999999999778e-01, 2.000000000000000000e+00,  2.834509293967866661e+00,  1.165490706032133339e+00],
                         [3.499999999999999778e-01, 2.100000000000000089e+00,  2.934509293967867194e+00,  1.265490706032133872e+00],
                         [3.499999999999999778e-01, 2.200000000000000178e+00,  3.034509293967866839e+00,  1.365490706032133073e+00],
                         [3.499999999999999778e-01, 2.300000000000000266e+00,  3.134509293967866927e+00,  1.465490706032134494e+00],
                         [4.000000000000000222e-01, 0.000000000000000000e+00,  2.084999999999998188e+00,  1.112314903453354598e+00],
                         [4.000000000000000222e-01, 1.000000000000000056e-01,  1.985000000000000764e+00,  1.113882569813412937e+00],
                         [4.000000000000000222e-01, 2.000000000000000111e-01,  1.885000000000000009e+00,  1.119261114228023102e+00],
                         [4.000000000000000222e-01, 3.000000000000000444e-01,  1.784999999999999698e+00,  1.132605029492260718e+00],
                         [4.000000000000000222e-01, 4.000000000000000222e-01,  1.685000000000000275e+00,  1.176530746332686395e+00],
                         [4.000000000000000222e-01, 5.000000000000000000e-01,  1.584999999999999742e+00,  1.276530746332686261e+00],
                         [4.000000000000000222e-01, 6.000000000000000888e-01,  1.484999999999999654e+00,  1.376530746332686350e+00],
                         [4.000000000000000222e-01, 7.000000000000000666e-01,  1.476530746332685329e+00,  1.385000000000000453e+00],
                         [4.000000000000000222e-01, 8.000000000000000444e-01,  1.576530746332685196e+00,  1.285000000000000808e+00],
                         [4.000000000000000222e-01, 9.000000000000000222e-01,  1.676530746332685062e+00,  1.185000000000001386e+00],
                         [4.000000000000000222e-01, 1.000000000000000000e+00,  1.776530746332686928e+00,  1.085000000000001519e+00],
                         [4.000000000000000222e-01, 1.100000000000000089e+00,  1.876530746332687460e+00,  9.850000000000003197e-01],
                         [4.000000000000000222e-01, 1.200000000000000178e+00,  1.976530746332687549e+00,  8.850000000000007860e-01],
                         [4.000000000000000222e-01, 1.300000000000000044e+00,  2.076530746332687194e+00,  7.850000000000008082e-01],
                         [4.000000000000000222e-01, 1.400000000000000133e+00,  2.176530746332687727e+00,  6.850000000000002753e-01],
                         [4.000000000000000222e-01, 1.500000000000000000e+00,  2.276530746332687372e+00,  7.234692536673134056e-01],
                         [4.000000000000000222e-01, 1.600000000000000089e+00,  2.376530746332687016e+00,  8.234692536673137164e-01],
                         [4.000000000000000222e-01, 1.700000000000000178e+00,  2.476530746332687549e+00,  9.234692536673133612e-01],
                         [4.000000000000000222e-01, 1.800000000000000044e+00,  2.576530746332687194e+00,  1.023469253667313339e+00],
                         [4.000000000000000222e-01, 1.900000000000000133e+00,  2.676530746332687727e+00,  1.123469253667313872e+00],
                         [4.000000000000000222e-01, 2.000000000000000000e+00,  2.776530746332686483e+00,  1.223469253667313517e+00],
                         [4.000000000000000222e-01, 2.100000000000000089e+00,  2.876530746332685240e+00,  1.323469253667314716e+00],
                         [4.000000000000000222e-01, 2.200000000000000178e+00,  2.976530746332686661e+00,  1.423469253667314138e+00],
                         [4.000000000000000222e-01, 2.300000000000000266e+00,  3.076530746332687194e+00,  1.523469253667314449e+00],
                         [4.500000000000000111e-01, 0.000000000000000000e+00,  2.074374999999997637e+00,  1.080575882703872059e+00],
                         [4.500000000000000111e-01, 1.000000000000000056e-01,  1.974375000000000657e+00,  1.081570652740295069e+00],
                         [4.500000000000000111e-01, 2.000000000000000111e-01,  1.874374999999999902e+00,  1.085236851537425551e+00],
                         [4.500000000000000111e-01, 3.000000000000000444e-01,  1.774375000000000036e+00,  1.093739117563362839e+00],
                         [4.500000000000000111e-01, 4.000000000000000222e-01,  1.674375000000000169e+00,  1.117796464113953059e+00],
                         [4.500000000000000111e-01, 5.000000000000000000e-01,  1.574375000000000080e+00,  1.204893262642473983e+00],
                         [4.500000000000000111e-01, 6.000000000000000888e-01,  1.474374999999999991e+00,  1.304893262642472740e+00],
                         [4.500000000000000111e-01, 7.000000000000000666e-01,  1.404893262642472607e+00,  1.374375000000000790e+00],
                         [4.500000000000000111e-01, 8.000000000000000444e-01,  1.504893262642471585e+00,  1.274375000000000702e+00],
                         [4.500000000000000111e-01, 9.000000000000000222e-01,  1.604893262642471008e+00,  1.174375000000000613e+00],
                         [4.500000000000000111e-01, 1.000000000000000000e+00,  1.704893262642472207e+00,  1.074375000000000968e+00],
                         [4.500000000000000111e-01, 1.100000000000000089e+00,  1.804893262642471630e+00,  9.743750000000008793e-01],
                         [4.500000000000000111e-01, 1.200000000000000178e+00,  1.904893262642472163e+00,  8.743750000000012346e-01],
                         [4.500000000000000111e-01, 1.300000000000000044e+00,  2.004893262642471807e+00,  7.743750000000011458e-01],
                         [4.500000000000000111e-01, 1.400000000000000133e+00,  2.104893262642472784e+00,  6.951067373575280373e-01],
                         [4.500000000000000111e-01, 1.500000000000000000e+00,  2.204893262642472429e+00,  7.951067373575283481e-01],
                         [4.500000000000000111e-01, 1.600000000000000089e+00,  2.304893262642471630e+00,  8.951067373575284369e-01],
                         [4.500000000000000111e-01, 1.700000000000000178e+00,  2.404893262642472607e+00,  9.951067373575284147e-01],
                         [4.500000000000000111e-01, 1.800000000000000044e+00,  2.504893262642472251e+00,  1.095106737357527837e+00],
                         [4.500000000000000111e-01, 1.900000000000000133e+00,  2.604893262642472784e+00,  1.195106737357528370e+00],
                         [4.500000000000000111e-01, 2.000000000000000000e+00,  2.704893262642472429e+00,  1.295106737357528015e+00],
                         [4.500000000000000111e-01, 2.100000000000000089e+00,  2.804893262642470741e+00,  1.395106737357528992e+00],
                         [4.500000000000000111e-01, 2.200000000000000178e+00,  2.904893262642472607e+00,  1.495106737357527749e+00],
                         [4.500000000000000111e-01, 2.300000000000000266e+00,  3.004893262642470919e+00,  1.595106737357529392e+00],
                         [5.000000000000000000e-01, 0.000000000000000000e+00,  2.062499999999999112e+00,  1.044007785863902305e+00],
                         [5.000000000000000000e-01, 1.000000000000000056e-01,  1.962499999999999911e+00,  1.044246045040817972e+00],
                         [5.000000000000000000e-01, 2.000000000000000111e-01,  1.862500000000000488e+00,  1.045618796606072598e+00],
                         [5.000000000000000000e-01, 3.000000000000000444e-01,  1.762500000000000178e+00,  1.050254176743700363e+00],
                         [5.000000000000000000e-01, 4.000000000000000222e-01,  1.662500000000000089e+00,  1.062243338303213269e+00],
                         [5.000000000000000000e-01, 5.000000000000000000e-01,  1.562500000000000000e+00,  1.114759861653313200e+00],
                         [5.000000000000000000e-01, 6.000000000000000888e-01,  1.462499999999999911e+00,  1.214759861653311734e+00],
                         [5.000000000000000000e-01, 7.000000000000000666e-01,  1.362499999999999822e+00,  1.314759861653311823e+00],
                         [5.000000000000000000e-01, 8.000000000000000444e-01,  1.414759861653311690e+00,  1.262500000000000178e+00],
                         [5.000000000000000000e-01, 9.000000000000000222e-01,  1.514759861653311335e+00,  1.162500000000000755e+00],
                         [5.000000000000000000e-01, 1.000000000000000000e+00,  1.614759861653311201e+00,  1.062500000000000888e+00],
                         [5.000000000000000000e-01, 1.100000000000000089e+00,  1.714759861653311512e+00,  9.625000000000007994e-01],
                         [5.000000000000000000e-01, 1.200000000000000178e+00,  1.814759861653311823e+00,  8.625000000000012657e-01],
                         [5.000000000000000000e-01, 1.300000000000000044e+00,  1.914759861653311246e+00,  7.625000000000005107e-01],
                         [5.000000000000000000e-01, 1.400000000000000133e+00,  2.014759861653311557e+00,  7.852401383466888207e-01],
                         [5.000000000000000000e-01, 1.500000000000000000e+00,  2.114759861653311646e+00,  8.852401383466884655e-01],
                         [5.000000000000000000e-01, 1.600000000000000089e+00,  2.214759861653311290e+00,  9.852401383466887763e-01],
                         [5.000000000000000000e-01, 1.700000000000000178e+00,  2.314759861653311379e+00,  1.085240138346688976e+00],
                         [5.000000000000000000e-01, 1.800000000000000044e+00,  2.414759861653311468e+00,  1.185240138346688621e+00],
                         [5.000000000000000000e-01, 1.900000000000000133e+00,  2.514759861653312001e+00,  1.285240138346688710e+00],
                         [5.000000000000000000e-01, 2.000000000000000000e+00,  2.614759861653309869e+00,  1.385240138346689021e+00],
                         [5.000000000000000000e-01, 2.100000000000000089e+00,  2.714759861653311290e+00,  1.485240138346688443e+00],
                         [5.000000000000000000e-01, 2.200000000000000178e+00,  2.814759861653310047e+00,  1.585240138346688976e+00],
                         [5.000000000000000000e-01, 2.300000000000000266e+00,  2.914759861653311912e+00,  1.685240138346688177e+00],
                         [5.500000000000000444e-01, 0.000000000000000000e+00,  2.044892617753401254e+00,  1.002098129871702881e+00],
                         [5.500000000000000444e-01, 1.000000000000000056e-01,  1.949375000000000302e+00,  1.001331019836644298e+00],
                         [5.500000000000000444e-01, 2.000000000000000111e-01,  1.849375000000000879e+00,  1.000891955213888851e+00],
                         [5.500000000000000444e-01, 3.000000000000000444e-01,  1.749375000000000568e+00,  1.001366987314174617e+00],
                         [5.500000000000000444e-01, 4.000000000000000222e-01,  1.649375000000000258e+00,  1.004340634511668995e+00],
                         [5.500000000000000444e-01, 5.000000000000000000e-01,  1.549374999999999059e+00,  1.018665389205231753e+00],
                         [5.500000000000000444e-01, 6.000000000000000888e-01,  1.449375000000000302e+00,  1.096038505782313655e+00],
                         [5.500000000000000444e-01, 7.000000000000000666e-01,  1.349375000000000213e+00,  1.196038505782314632e+00],
                         [5.500000000000000444e-01, 8.000000000000000444e-01,  1.296038505782312722e+00,  1.249375000000001457e+00],
                         [5.500000000000000444e-01, 9.000000000000000222e-01,  1.396038505782310368e+00,  1.149375000000000924e+00],
                         [5.500000000000000444e-01, 1.000000000000000000e+00,  1.496038505782310901e+00,  1.049375000000000835e+00],
                         [5.500000000000000444e-01, 1.100000000000000089e+00,  1.596038505782311656e+00,  9.493750000000007461e-01],
                         [5.500000000000000444e-01, 1.200000000000000178e+00,  1.696038505782311745e+00,  8.493750000000005462e-01],
                         [5.500000000000000444e-01, 1.300000000000000044e+00,  1.796038505782310946e+00,  8.039614942176883661e-01],
                         [5.500000000000000444e-01, 1.400000000000000133e+00,  1.896038505782313033e+00,  9.039614942176875667e-01],
                         [5.500000000000000444e-01, 1.500000000000000000e+00,  1.996038505782312011e+00,  1.003961494217687989e+00],
                         [5.500000000000000444e-01, 1.600000000000000089e+00,  2.096038505782312100e+00,  1.103961494217688077e+00],
                         [5.500000000000000444e-01, 1.700000000000000178e+00,  2.196038505782312189e+00,  1.203961494217688388e+00],
                         [5.500000000000000444e-01, 1.800000000000000044e+00,  2.296038505782310946e+00,  1.303961494217689365e+00],
                         [5.500000000000000444e-01, 1.900000000000000133e+00,  2.396038505782312811e+00,  1.403961494217687456e+00],
                         [5.500000000000000444e-01, 2.000000000000000000e+00,  2.496038505782312011e+00,  1.503961494217687545e+00],
                         [5.500000000000000444e-01, 2.100000000000000089e+00,  2.596038505782310768e+00,  1.603961494217689410e+00],
                         [5.500000000000000444e-01, 2.200000000000000178e+00,  2.696038505782312633e+00,  1.703961494217688166e+00],
                         [5.500000000000000444e-01, 2.300000000000000266e+00,  2.796038505782310502e+00,  1.803961494217689143e+00],
                         [5.999999999999999778e-01, 0.000000000000000000e+00,  2.021144477765010716e+00,  9.541619359416956270e-01],
                         [5.999999999999999778e-01, 1.000000000000000056e-01,  1.935000000000000053e+00,  9.522087522620659161e-01],
                         [5.999999999999999778e-01, 2.000000000000000111e-01,  1.834999999999999742e+00,  9.506058322764412427e-01],
                         [5.999999999999999778e-01, 3.000000000000000444e-01,  1.735000000000000098e+00,  9.457098705623061541e-01],
                         [5.999999999999999778e-01, 4.000000000000000222e-01,  1.634999999999999565e+00,  9.419638323092884846e-01],
                         [5.999999999999999778e-01, 5.000000000000000000e-01,  1.534999999999999254e+00,  9.384587504163306448e-01],
                         [5.999999999999999778e-01, 6.000000000000000888e-01,  1.434999999999999387e+00,  9.432736184290809733e-01],
                         [5.999999999999999778e-01, 7.000000000000000666e-01,  1.334999999999999520e+00,  1.018001572323153692e+00],
                         [5.999999999999999778e-01, 8.000000000000000444e-01,  1.234999999999999654e+00,  1.118001572323154003e+00],
                         [5.999999999999999778e-01, 9.000000000000000222e-01,  1.218001572323153869e+00,  1.135000000000000675e+00],
                         [5.999999999999999778e-01, 1.000000000000000000e+00,  1.318001572323153514e+00,  1.035000000000000364e+00],
                         [5.999999999999999778e-01, 1.100000000000000089e+00,  1.418001572323156267e+00,  9.350000000000007194e-01],
                         [5.999999999999999778e-01, 1.200000000000000178e+00,  1.518001572323153470e+00,  8.819984276768466636e-01],
                         [5.999999999999999778e-01, 1.300000000000000044e+00,  1.618001572323153336e+00,  9.819984276768459752e-01],
                         [5.999999999999999778e-01, 1.400000000000000133e+00,  1.718001572323153869e+00,  1.081998427676845953e+00],
                         [5.999999999999999778e-01, 1.500000000000000000e+00,  1.818001572323153292e+00,  1.181998427676846042e+00],
                         [5.999999999999999778e-01, 1.600000000000000089e+00,  1.918001572323156267e+00,  1.281998427676844354e+00],
                         [5.999999999999999778e-01, 1.700000000000000178e+00,  2.018001572323153692e+00,  1.381998427676846442e+00],
                         [5.999999999999999778e-01, 1.800000000000000044e+00,  2.118001572323152892e+00,  1.481998427676846308e+00],
                         [5.999999999999999778e-01, 1.900000000000000133e+00,  2.218001572323154313e+00,  1.581998427676845287e+00],
                         [5.999999999999999778e-01, 2.000000000000000000e+00,  2.318001572323153514e+00,  1.681998427676845376e+00],
                         [5.999999999999999778e-01, 2.100000000000000089e+00,  2.418001572323155823e+00,  1.781998427676844354e+00],
                         [5.999999999999999778e-01, 2.200000000000000178e+00,  2.518001572323153692e+00,  1.881998427676846219e+00],
                         [5.999999999999999778e-01, 2.300000000000000266e+00,  2.618001572323156445e+00,  1.981998427676843866e+00],
                         [6.500000000000000222e-01, 0.000000000000000000e+00,  1.994974776735040090e+00,  8.992575846547149476e-01],
                         [6.500000000000000222e-01, 1.000000000000000056e-01,  1.919374999999999609e+00,  8.971809316223818831e-01],
                         [6.500000000000000222e-01, 2.000000000000000111e-01,  1.819375000000000187e+00,  8.922345602915452423e-01],
                         [6.500000000000000222e-01, 3.000000000000000444e-01,  1.719375000000000098e+00,  8.848238219854202002e-01],
                         [6.500000000000000222e-01, 4.000000000000000222e-01,  1.619375000000000009e+00,  8.724300852185140620e-01],
                         [6.500000000000000222e-01, 5.000000000000000000e-01,  1.519374999999999698e+00,  8.565991776215980957e-01],
                         [6.500000000000000222e-01, 6.000000000000000888e-01,  1.419375000000000941e+00,  8.359412130733904212e-01],
                         [6.500000000000000222e-01, 7.000000000000000666e-01,  1.319374999999999964e+00,  8.050424980765564786e-01],
                         [6.500000000000000222e-01, 8.000000000000000444e-01,  1.219375000000000098e+00,  8.000000000000015987e-01],
                         [6.500000000000000222e-01, 9.000000000000000222e-01,  1.119374999999999787e+00,  9.000000000000020206e-01],
                         [6.500000000000000222e-01, 1.000000000000000000e+00,  1.019375000000000586e+00,  1.000000000000001776e+00],
                         [6.500000000000000222e-01, 1.100000000000000089e+00,  1.047724525234536408e+00,  1.099999999999998090e+00],
                         [6.500000000000000222e-01, 1.200000000000000178e+00,  1.187552213888419805e+00,  1.199999999999997957e+00],
                         [6.500000000000000222e-01, 1.300000000000000044e+00,  1.295260860529996005e+00,  1.299999999999998934e+00],
                         [6.500000000000000222e-01, 1.400000000000000133e+00,  1.397860415932046685e+00,  1.399999999999999467e+00],
                         [6.500000000000000222e-01, 1.500000000000000000e+00,  1.499002505609944746e+00,  1.499999999999997780e+00],
                         [6.500000000000000222e-01, 1.600000000000000089e+00,  1.599581909046844830e+00,  1.599999999999998312e+00],
                         [6.500000000000000222e-01, 1.700000000000000178e+00,  1.699435064626961811e+00,  1.699999999999998845e+00],
                         [6.500000000000000222e-01, 1.800000000000000044e+00,  1.800000000000000266e+00,  1.800521853101132219e+00],
                         [6.500000000000000222e-01, 1.900000000000000133e+00,  1.900000000000000355e+00,  1.900847030330855114e+00],
                         [6.500000000000000222e-01, 2.000000000000000000e+00,  2.000000000000000444e+00,  2.001044497669290045e+00],
                         [6.500000000000000222e-01, 2.100000000000000089e+00,  2.100000000000000533e+00,  2.101164175498988040e+00],
                         [6.500000000000000222e-01, 2.200000000000000178e+00,  2.200000000000000622e+00,  2.201234712213494760e+00],
                         [6.500000000000000222e-01, 2.300000000000000266e+00,  2.300000000000000711e+00,  2.301273346989102464e+00],
                         [6.999999999999999556e-01, 0.000000000000000000e+00,  1.966277724604989618e+00,  8.446591860820705788e-01],
                         [6.999999999999999556e-01, 1.000000000000000056e-01,  1.902500000000000524e+00,  8.425162621826328690e-01],
                         [6.999999999999999556e-01, 2.000000000000000111e-01,  1.802499999999999991e+00,  8.373099017202239036e-01],
                         [6.999999999999999556e-01, 3.000000000000000444e-01,  1.702500000000000124e+00,  8.284124430892315649e-01],
                         [6.999999999999999556e-01, 4.000000000000000222e-01,  1.602500000000000258e+00,  8.153289726285524175e-01],
                         [6.999999999999999556e-01, 5.000000000000000000e-01,  1.502500000000000391e+00,  7.943789130940115406e-01],
                         [6.999999999999999556e-01, 6.000000000000000888e-01,  1.402500000000000968e+00,  7.637597698787992329e-01],
                         [6.999999999999999556e-01, 7.000000000000000666e-01,  1.302500000000000213e+00,  7.192180072923576306e-01],
                         [6.999999999999999556e-01, 8.000000000000000444e-01,  1.202499999999999458e+00,  8.000000000000012657e-01],
                         [6.999999999999999556e-01, 9.000000000000000222e-01,  1.102499999999999591e+00,  9.000000000000013545e-01],
                         [6.999999999999999556e-01, 1.000000000000000000e+00,  1.002500000000000169e+00,  1.000000000000000888e+00],
                         [6.999999999999999556e-01, 1.100000000000000089e+00,  1.044740356562749994e+00,  1.099999999999999867e+00],
                         [6.999999999999999556e-01, 1.200000000000000178e+00,  1.107537222356992812e+00,  1.199999999999999734e+00],
                         [6.999999999999999556e-01, 1.300000000000000044e+00,  1.256367975549840699e+00,  1.299999999999999822e+00],
                         [6.999999999999999556e-01, 1.400000000000000133e+00,  1.382734320763534974e+00,  1.399999999999999911e+00],
                         [6.999999999999999556e-01, 1.500000000000000000e+00,  1.492378521990670448e+00,  1.499999999999999556e+00],
                         [6.999999999999999556e-01, 1.600000000000000089e+00,  1.596872451292468797e+00,  1.600000000000000089e+00],
                         [6.999999999999999556e-01, 1.700000000000000178e+00,  1.697407426621849957e+00,  1.701690718963503768e+00],
                         [6.999999999999999556e-01, 1.800000000000000044e+00,  1.799700076193153864e+00,  1.803517808161156921e+00],
                         [6.999999999999999556e-01, 1.900000000000000133e+00,  1.900000000000001021e+00,  1.904580638524064229e+00],
                         [6.999999999999999556e-01, 2.000000000000000000e+00,  2.000000000000000444e+00,  2.005203386161994228e+00],
                         [6.999999999999999556e-01, 2.100000000000000089e+00,  2.100000000000000089e+00,  2.105559648894466118e+00],
                         [6.999999999999999556e-01, 2.200000000000000178e+00,  2.200000000000000178e+00,  2.205776239274906292e+00],
                         [6.999999999999999556e-01, 2.300000000000000266e+00,  2.300000000000000266e+00,  2.305891648938765304e+00],
                         [7.500000000000000000e-01, 0.000000000000000000e+00,  1.934930882365374361e+00,  8.023512644156483020e-01],
                         [7.500000000000000000e-01, 1.000000000000000056e-01,  1.884374999999999467e+00,  8.005073741397423781e-01],
                         [7.500000000000000000e-01, 2.000000000000000111e-01,  1.784374999999999600e+00,  7.950222289553517951e-01],
                         [7.500000000000000000e-01, 3.000000000000000444e-01,  1.684374999999999956e+00,  7.845705162007509115e-01],
                         [7.500000000000000000e-01, 4.000000000000000222e-01,  1.584375000000000089e+00,  7.666734567584424509e-01],
                         [7.500000000000000000e-01, 5.000000000000000000e-01,  1.484374999999999556e+00,  7.402532930457867977e-01],
                         [7.500000000000000000e-01, 6.000000000000000888e-01,  1.384374999999999911e+00,  7.039964290809375136e-01],
                         [7.500000000000000000e-01, 7.000000000000000666e-01,  1.284375000000000044e+00,  7.000000000000001776e-01],
                         [7.500000000000000000e-01, 8.000000000000000444e-01,  1.184374999999999734e+00,  8.000000000000000444e-01],
                         [7.500000000000000000e-01, 9.000000000000000222e-01,  1.084374999999999867e+00,  9.000000000000002442e-01],
                         [7.500000000000000000e-01, 1.000000000000000000e+00,  9.957917721395687094e-01,  9.999999999999997780e-01],
                         [7.500000000000000000e-01, 1.100000000000000089e+00,  1.028328063720570063e+00,  1.099999999999999867e+00],
                         [7.500000000000000000e-01, 1.200000000000000178e+00,  1.086121674408581095e+00,  1.199999999999999289e+00],
                         [7.500000000000000000e-01, 1.300000000000000044e+00,  1.234900833536150211e+00,  1.299999999999999822e+00],
                         [7.500000000000000000e-01, 1.400000000000000133e+00,  1.359512493831690705e+00,  1.399999999999999911e+00],
                         [7.500000000000000000e-01, 1.500000000000000000e+00,  1.481096994359893060e+00,  1.499999999999999556e+00],
                         [7.500000000000000000e-01, 1.600000000000000089e+00,  1.591021484456062840e+00,  1.600060710345906356e+00],
                         [7.500000000000000000e-01, 1.700000000000000178e+00,  1.696476608147529541e+00,  1.704387097094532288e+00],
                         [7.500000000000000000e-01, 1.800000000000000044e+00,  1.799743491641358828e+00,  1.806822305744524959e+00],
                         [7.500000000000000000e-01, 1.900000000000000133e+00,  1.900000000000000355e+00,  1.908229510247779315e+00],
                         [7.500000000000000000e-01, 2.000000000000000000e+00,  1.999999999999999778e+00,  2.009037958085909459e+00],
                         [7.500000000000000000e-01, 2.100000000000000089e+00,  2.100000000000000089e+00,  2.109481105214379593e+00],
                         [7.500000000000000000e-01, 2.200000000000000178e+00,  2.200000000000000178e+00,  2.209694126978098083e+00],
                         [7.500000000000000000e-01, 2.300000000000000266e+00,  2.300000000000000266e+00,  2.309759019354703291e+00],
                         [8.000000000000000444e-01, 0.000000000000000000e+00,  1.900792232494416201e+00,  7.649342946036998825e-01],
                         [8.000000000000000444e-01, 1.000000000000000056e-01,  1.864999999999999991e+00,  7.630926457208468960e-01],
                         [8.000000000000000444e-01, 2.000000000000000111e-01,  1.764999999999999014e+00,  7.560904437934243827e-01],
                         [8.000000000000000444e-01, 3.000000000000000444e-01,  1.664999999999999369e+00,  7.419144194847687723e-01],
                         [8.000000000000000444e-01, 4.000000000000000222e-01,  1.564999999999999725e+00,  7.204098751622235453e-01],
                         [8.000000000000000444e-01, 5.000000000000000000e-01,  1.464999999999999858e+00,  6.903947940357125779e-01],
                         [8.000000000000000444e-01, 6.000000000000000888e-01,  1.364999999999999991e+00,  6.508374218517269938e-01],
                         [8.000000000000000444e-01, 7.000000000000000666e-01,  1.264999999999999902e+00,  7.000000000000005107e-01],
                         [8.000000000000000444e-01, 8.000000000000000444e-01,  1.165000000000000036e+00,  8.000000000000010436e-01],
                         [8.000000000000000444e-01, 9.000000000000000222e-01,  1.064999999999999725e+00,  9.000000000000007994e-01],
                         [8.000000000000000444e-01, 1.000000000000000000e+00,  9.870271299885613470e-01,  9.999999999999998890e-01],
                         [8.000000000000000444e-01, 1.100000000000000089e+00,  1.027469680947971975e+00,  1.099999999999999645e+00],
                         [8.000000000000000444e-01, 1.200000000000000178e+00,  1.047687197175640961e+00,  1.200000000000000178e+00],
                         [8.000000000000000444e-01, 1.300000000000000044e+00,  1.206958109304342219e+00,  1.299999999999999822e+00],
                         [8.000000000000000444e-01, 1.400000000000000133e+00,  1.347974514265563917e+00,  1.400000000000000355e+00],
                         [8.000000000000000444e-01, 1.500000000000000000e+00,  1.475846336591688734e+00,  1.499999999999999112e+00],
                         [8.000000000000000444e-01, 1.600000000000000089e+00,  1.588218888479503210e+00,  1.604160505968567518e+00],
                         [8.000000000000000444e-01, 1.700000000000000178e+00,  1.695161356482507875e+00,  1.709181455888932666e+00],
                         [8.000000000000000444e-01, 1.800000000000000044e+00,  1.799393001824892480e+00,  1.811985229321850577e+00],
                         [8.000000000000000444e-01, 1.900000000000000133e+00,  1.900000000000000799e+00,  1.913568706671904263e+00],
                         [8.000000000000000444e-01, 2.000000000000000000e+00,  2.000000000000000444e+00,  2.014436117225905765e+00],
                         [8.000000000000000444e-01, 2.100000000000000089e+00,  2.100000000000000533e+00,  2.114865316891791913e+00],
                         [8.000000000000000444e-01, 2.200000000000000178e+00,  2.200000000000000622e+00,  2.215018800547307709e+00],
                         [8.000000000000000444e-01, 2.300000000000000266e+00,  2.300000000000000266e+00,  2.314995853043838814e+00],
                         [8.499999999999999778e-01, 0.000000000000000000e+00,  1.863696451672238075e+00,  7.299312125422763309e-01],
                         [8.499999999999999778e-01, 1.000000000000000056e-01,  1.835092005107931357e+00,  7.272248074921958683e-01],
                         [8.499999999999999778e-01, 2.000000000000000111e-01,  1.744375000000000009e+00,  7.176089823424585123e-01],
                         [8.499999999999999778e-01, 3.000000000000000444e-01,  1.644375000000000142e+00,  7.007554532617021881e-01],
                         [8.499999999999999778e-01, 4.000000000000000222e-01,  1.544375000000000053e+00,  6.762586342793547312e-01],
                         [8.499999999999999778e-01, 5.000000000000000000e-01,  1.444374999999999520e+00,  6.437774205815199879e-01],
                         [8.499999999999999778e-01, 6.000000000000000888e-01,  1.344375000000000320e+00,  6.025368116707182642e-01],
                         [8.499999999999999778e-01, 7.000000000000000666e-01,  1.244375000000000009e+00,  7.000000000000007327e-01],
                         [8.499999999999999778e-01, 8.000000000000000444e-01,  1.144375000000001030e+00,  8.000000000000008216e-01],
                         [8.499999999999999778e-01, 9.000000000000000222e-01,  1.044375000000000497e+00,  9.000000000000006883e-01],
                         [8.499999999999999778e-01, 1.000000000000000000e+00,  9.807091850373551578e-01,  1.000000000000000000e+00],
                         [8.499999999999999778e-01, 1.100000000000000089e+00,  1.006175012106693911e+00,  1.099999999999999645e+00],
                         [8.499999999999999778e-01, 1.200000000000000178e+00,  1.056166576245905597e+00,  1.199999999999999956e+00],
                         [8.499999999999999778e-01, 1.300000000000000044e+00,  1.154330335954040443e+00,  1.299999999999999822e+00],
                         [8.499999999999999778e-01, 1.400000000000000133e+00,  1.336440540510876129e+00,  1.399999999999999689e+00],
                         [8.499999999999999778e-01, 1.500000000000000000e+00,  1.470862395001374612e+00,  1.499999999999999556e+00],
                         [8.499999999999999778e-01, 1.600000000000000089e+00,  1.585848744882261796e+00,  1.610165362112707443e+00],
                         [8.499999999999999778e-01, 1.700000000000000178e+00,  1.694327310468400682e+00,  1.715779884279897249e+00],
                         [8.499999999999999778e-01, 1.800000000000000044e+00,  1.799543863836537083e+00,  1.818863998392789227e+00],
                         [8.499999999999999778e-01, 1.900000000000000133e+00,  1.900000000000000133e+00,  1.920547622658940412e+00],
                         [8.499999999999999778e-01, 2.000000000000000000e+00,  1.999999999999999778e+00,  2.021406920153674402e+00],
                         [8.499999999999999778e-01, 2.100000000000000089e+00,  2.100000000000000533e+00,  2.121761778251578523e+00],
                         [8.499999999999999778e-01, 2.200000000000000178e+00,  2.200000000000000622e+00,  2.221800446463567003e+00],
                         [8.499999999999999778e-01, 2.300000000000000266e+00,  2.300000000000000711e+00,  2.321638489659120896e+00]])
        # get where data[:, 0] == aoverl, data[:, 1] == ABDelta
        # If there is no precise match, interpolate
        if (np.abs(mglat.lp['aoverl'] - data[:, 0]) < eps).any():
            # there is a match in aoverl
            rows = np.where(np.abs(mglat.lp['aoverl'] - data[:, 0]) < eps)[0]
            if (np.abs(mglat.lp['ABDelta'] - data[:, 1]) < eps).any():
                # There is also a match in abdelta
                subrows = np.where(np.abs(mglat.lp['ABDelta'] - data[rows, 1]) < eps)[0]
                if len(subrows) == 1:
                    midfreq = 0.5 * (data[rows][subrows][:, 2] + data[rows][subrows][:, 3])
                else:
                    print 'magnetic_gyro_spectral_data.py: subrows = ', subrows
                    raise RuntimeError('Found more than one match')
            else:
                # interpolate the ABdelta values
                min_interp = interpolate.interp1d(data[rows][:, 1], data[rows][:, 2])
                max_interp = interpolate.interp1d(data[rows][:, 1], data[rows][:, 3])
                midfreq = [0.5 * (min_interp(mglat.lp['ABDelta']) + max_interp(mglat.lp['ABDelta']))]
        else:
            # do 2d interpolation of aoverl and abdelta values
            min_interp = interpolate.interp1d(data[:, 0], data[:, 1], data[:, 2])
            max_interp = interpolate.interp1d(data[:, 0], data[:, 1], data[:, 3])
            midfreq = [0.5 * (min_interp(mglat.lp['aoverl'], mglat.lp['ABDelta']) +
                              max_interp(mglat.lp['aoverl'], mglat.lp['ABDelta']))]
    else:
        raise RuntimeError('Have not coded up other lattice topologies yet')

    return np.array([midfreq[0]])


if __name__ == '__main__':
    # Load data and save a large array with aoverl ABDelta freqmin freqmax
    # Do honeycomb magnetic gyrolattice
    rootdir = '/Users/npmitchell/Dropbox/Soft_Matter/GPU/networks/hexagonal/'
    rootdir += 'hexagonal_square_periodicBC_delta0p667_phi0p000_000001_x_000001/'
    name = 'dispersion_abtrans_magnetic_'
    globs = glob.glob(rootdir + name + '*.txt')
    first = True
    for fn in globs:
        # name_exten = 'aol' + sf.float2pstr(aol, ndigits=2) + '_ABd' + sf.float2pstr(abd, ndigits=3) + '_gapbounds'
        aol = float(fn.split(rootdir + name)[-1].split('aol')[-1].split('_')[0].replace('p', '.'))
        data = np.loadtxt(fn)
        print 'aol * np.ones((len(data), 1)) = ', aol * np.ones((len(data), 1))
        print 'np.shape(data) = ', np.shape(data)
        to_add = np.dstack((aol * np.ones((len(data))), data[:, 0], data[:, 1], data[:, 2]))[0]
        if first:
            output = to_add
            first = False
        else:
            output = np.vstack((output, to_add))

    # output the compiled data
    outname = rootdir + name + 'compiled.txt'
    print 'saving output: ', outname
    # np.savetxt(outname, output, delimiter=',')
    with open(outname, "w") as fn:
        for line in output:
            fn.write('                 [{0:0.18e}'.format(line[0]) + ', {0:0.18e}'.format(line[1]) +
                     ', {0:0.18e}'.format(line[2]) + ', {0:0.18e}'.format(line[3]) + '], \n')

